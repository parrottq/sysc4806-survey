<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Mini Survey</title>
    <link th:href="@{/index.css}" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script type="text/javascript" th:src="@{/index.js}"></script>
    <script type="text/javascript" th:src="@{/socket.js}"></script>
    <script type="text/javascript" th:src="@{/chart.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="icon" type="image/x-icon" th:src="@{/images/favicon.ico}">
</head>
<body>
    <script th:inline="javascript">
        var pollData = /*[[${poll}]]*/ null;
    </script>
    <nav class="site-nav">
        <i class="fa-regular fa-paper-plane nav-icon"></i>
        <h1 class="site-title">Mini-Survey</h1>
        <button style="margin-left: auto" onclick="location.href='/create'">Create</button>
        <button onclick="location.href='/display-polls'">View Polls</button>
    </nav>
    <div class="survey-container">
        <div class="poll-results-container">
            <div class="center-text">
                <p th:text="'Poll Title: ' + ${poll.title}"></p>
                <p id="poll_id" th:text="'ID: ' + ${poll.id}"></p>
                <button class="view-results-button" type="button" onclick="displayPolls()">
                    Return To Polls
                </button>
            </div>
            <div class="center-text" th:each="question: ${poll.questions}">
<!--                <div id="question">-->
<!--                    <hr>-->
<!--                    <p th:text="'ID: ' + ${question.id}"></p>-->
<!--                    <p th:text="'   Question: ' + ${question.title}"></p>-->
<!--                    <div th:switch="${question.questionType}">-->
<!--                        <p th:case="'MultipleChoice'">-->
<!--                            <div th:each="choice: ${question.possibleChoices}">-->
<!--                                <p th:text="'Choice: ' + ${choice.getAnswerChoice()}"></p>-->
<!--                            </div>-->
<!--                        </p>-->
<!--                    </div>-->
<!--                    <p>Answers:</p>-->
<!--&lt;!&ndash;                    <button type="open-button" class="collapsible">Open Collapsible</button>&ndash;&gt;-->
<!--                    <div id="answers">-->
<!--                        <div th:each="answer: ${question.answers}">-->
<!--                            <p th:text="${answer.getAnswerChoice()}"></p>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
                <div id="question" th:data-question-type="${question.questionType}">
<!--                <div id="question-${question.id}" th:data-question-type="${question.questionType}">-->

                    <hr>
                    <p th:text="'ID: ' + ${question.id}"></p>
                    <p th:text="'   Question: ' + ${question.title}"></p>
                    <div th:switch="${question.questionType}">
                        <p th:case="'MultipleChoice'">
                            <div th:each="choice: ${question.possibleChoices}">
                                <p th:text="'Choice: ' + ${choice.getAnswerChoice()}"></p>
                            </div>
                            <div th:id="'pie-chart-' + ${question.id}"></div>
                        </p>
                        <p th:case="'Text'">
                            <p>Answers:</p>
                            <div id="answers">
                                <div th:each="answer: ${question.answers}">
                                    <p th:text="${answer.getAnswerChoice()}"></p>
                                </div>
                            </div>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // var coll = document.getElementsByClassName("collapsible");
        // var i;
        //
        // for (i = 0; i < coll.length; i++) {
        // coll[i].addEventListener("click", function() {
        //     this.classList.toggle("active");
        //     var content = this.nextElementSibling;
        //     if (content.style.display === "block") {
        //         this.innerHTML = "Open Collapsable"
        //         content.style.display = "none";
        //     } else {
        //         this.innerHTML = "Close Collapsable"
        //         content.style.display = "block";
        //     }
        // });
        // }

        let elem = document.getElementById("poll_id");
        // const regex = /[a-z,0-9]{8}-[a-z,0-9]{4}-4[a-z,0-9]{3}-[89AB][a-z,0-9]{3}-[a-z,0-9]{12}$/;
        subscribe(elem.innerHTML.split(": ")[1]);

        $(document).ready(function() {

            let pollDataFromServer;

            pollDataFromServer = pollData;

            for (let question of pollDataFromServer.questions) {
                // Check if the question is a multiple-choice question
                if (question.questionType === 'MultipleChoice') {
                    // Generate the pie chart
                    Highcharts.chart('pie-chart-' + question.id, {
                        // Your Highcharts configuration options for each chart
                        chart: {
                            type: 'pie'
                        },
                        title: {
                            text: 'Results',
                            align: 'left'
                        },
                        subtitle: {
                            text: 'animation of pie series',
                            align: 'left'
                        },
                        // ... (other Highcharts options)
                        // series: [{
                        //     data: pollDataFromServer // Use poll data as needed
                        // }]
                        series: [{
                            // Disable mouse tracking on load, enable after custom animation
                            enableMouseTracking: false,
                            animation: {
                                duration: 2000
                            },
                            colorByPoint: true,
                            data: [{
                                name: 'Always',
                                y: 0
                            }, {
                                name: 'Sometimes',
                                y: 0
                            }, {
                                name: 'One in a while',
                                y: 0
                            }, {
                                name: 'Never',
                                y: 0
                            }, {
                                name: 'Prefer not to answer',
                                y: 0
                            }]
                        }]
                    });
                }
            }
        });

        //     // Iterate through each question
        //     $(".pie-chart-container").each(function() {
        //         // Get the question ID from the container ID
        //         let questionId = $(this).attr("id").split("-")[2];
        //
        //         // Get the question type from the data attribute
        //         let questionType = $("#question-" + questionId).data("question-type");
        //
        //
        //         // Check if the question is of type "MultipleChoice"
        //         if (questionType === "MultipleChoice") {
        //             // Use pollDataFromServer to access poll data and generate Highcharts chart
        //             Highcharts.chart('pie-chart-container-' + questionId, {
        //                 // Your Highcharts configuration options for each chart
        //                 chart: {
        //                     type: 'pie'
        //                 },
        //                 title: {
        //                     text: 'Results',
        //                     align: 'left'
        //                 },
        //                 subtitle: {
        //                     text: 'animation of pie series',
        //                     align: 'left'
        //                 },
        //                 // ... (other Highcharts options)
        //                 // series: [{
        //                 //     data: pollDataFromServer // Use poll data as needed
        //                 // }]
        //                 series: [{
        //                     // Disable mouse tracking on load, enable after custom animation
        //                     enableMouseTracking: false,
        //                     animation: {
        //                         duration: 2000
        //                     },
        //                     colorByPoint: true,
        //                     data: [{
        //                         name: 'Always',
        //                         y: 21.3
        //                     }, {
        //                         name: 'Sometimes',
        //                         y: 18.7
        //                     }, {
        //                         name: 'One in a while',
        //                         y: 20.2
        //                     }, {
        //                         name: 'Never',
        //                         y: 14.2
        //                     }, {
        //                         name: 'Prefer not to answer',
        //                         y: 25.6
        //                     }]
        //                 }]
        //             });
        //         }
        //     });
        // });

    </script>
</body>
</html>